listen {
    type = auth
    ipaddr = *
    port = 1812
}

listen {
    type = acct
    ipaddr = *
    port = 1813
}

server default {
    authorize {
        # Add these before your SQL check
        preprocess
        
        # For MAC auth, you might need to reformat the MAC
        rewrite_calling_station_id
        
        sql
        
        if ("%{sql:SELECT enabled FROM clients WHERE mac = '%{Calling-Station-Id}'}" == "1") {
            update control {
                Auth-Type := Accept
            }
            ok
        }
        else {
            reject
        }
    }

    authenticate {
        # This section might be unnecessary if you're using Auth-Type := Accept
        Auth-Type Accept {
            ok
        }
    }

    # Add these sections
    post-auth {
        sql
    }

    accounting {
        sql
    }
}