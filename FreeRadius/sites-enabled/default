listen {
    type = auth
    ipaddr = *
    port = 1812
}

listen {
    type = acct
    ipaddr = *
    port = 1813
}

server default {
    authorize {
        # Basic preprocessing
        preprocess
        
        # Query SQL to check if MAC is enabled
        sql
        
        if ("%{sql:SELECT enabled FROM clients WHERE mac = '%{Calling-Station-Id}'}" == "1") {
            update control {
                Auth-Type := Accept
            }
        }
        else {
            reject
        }
    }

    authenticate {
        # This must match the Auth-Type you set in authorize
        Auth-Type Accept {
            ok
        }
        
        # If you want SQL auth as fallback
        Auth-Type SQL {
            sql
        }
    }

    # Add post-auth section to handle both success and failure
    post-auth {
        sql
        
        Post-Auth-Type REJECT {
            sql
            attr_filter.access_reject
        }
    }

    # Add accounting section
    accounting {
        sql
    }
}