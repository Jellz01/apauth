<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Registro - WiFi Público</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
        }

        .top-image, .bottom-image {
            width: 100%;
            max-width: 400px;
            border-radius: 10px;
        }

        .form-container {
            background: white;
            padding: 25px 20px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            width: 100%;
            max-width: 400px;
            margin: 15px 0;
        }

        h2 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }

        button {
            width: 100%;
            padding: 14px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.05rem;
            cursor: pointer;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        button:hover {
            background: #5568d3;
        }

        .mac-display {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 8px;
            margin-top: 12px;
            font-size: 0.9rem;
            color: #333;
            text-align: center;
            word-wrap: break-word;
            display: none; /* hidden by default */
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-size: 0.9rem;
            display: none;
        }

        @media (max-width: 480px) {
            .form-container {
                padding: 20px 15px;
                border-radius: 10px;
            }
            input, button {
                font-size: 1rem;
            }
            h2 {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>

    <!-- Imagen superior -->
    <img src="gonetlogo.png" alt="WiFi Banner" class="top-image">

    <div class="form-container">
        <h2>BIENVENIDOS</h2>

        <form id="wifiForm" method="POST" action="main.php">
            <input type="text" id="nombre" name="nombre" placeholder="Nombre" required>
            <input type="text" id="apellido" name="apellido" placeholder="Apellido" required>
            <input type="text" id="cedula" name="cedula" placeholder="Cédula" required>
            <input type="tel" id="telefono" name="telefono" placeholder="Teléfono (09XXXXXXXX)" required pattern="09[0-9]{8}">
            <input type="email" id="correo" name="correo" placeholder="Correo electrónico" required>

            <!-- Optional MAC field -->
            <input type="hidden" name="mac" id="macInput">

            <button type="submit">Registrarse</button>
            <div class="mac-display" id="macDisplay"></div>
        </form>

        <div class="error" id="errorMsg"></div>
    </div>

    <!-- Imagen inferior -->
    <img src="banner.png" alt="WiFi Footer" class="bottom-image">

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const params = new URLSearchParams(window.location.search);
            const mac = params.get("mac");
            const macDisplay = document.getElementById("macDisplay");
            const macInput = document.getElementById("macInput");

            // MAC is optional — only show if provided
            if (mac && mac.trim() !== "") {
                macDisplay.style.display = "block";
                macDisplay.textContent = "MAC: " + mac;
                macInput.value = mac;
                console.log("✅ MAC detectada:", mac);
            } else {
                macDisplay.style.display = "none";
                macInput.value = ""; // no MAC sent
                console.log("ℹ️ No se detectó MAC, pero no es necesaria.");
            }
        });

        // ✅ Validación de cédula ecuatoriana
        function validarCedula(cedula) {
            if (!/^\d{10}$/.test(cedula)) return false;
            const region = parseInt(cedula.substring(0, 2));
            if (region < 1 || region > 24) return false;
            const ultimo = parseInt(cedula[9]);
            let suma = 0;
            for (let i = 0; i < 9; i++) {
                let num = parseInt(cedula[i]);
                if (i % 2 === 0) {
                    num *= 2;
                    if (num > 9) num -= 9;
                }
                suma += num;
            }
            const decena = Math.ceil(suma / 10) * 10;
            return (decena - suma === 10 ? 0 : decena - suma) === ultimo;
        }

        // ✅ Validación del teléfono ecuatoriano (09XXXXXXXX)
        function validarTelefono(telefono) {
            return /^09\d{8}$/.test(telefono);
        }

        // ✅ Validación completa del formulario
        document.getElementById("wifiForm").addEventListener("submit", function (e) {
             const params = new URLSearchParams(window.location.search);
    const mac = params.get("mac") || "No MAC";
    const ip = params.get("ip") || "No IP";
    const ap = params.get("ap") || "No AP MAC";

    // Display them on the page
    const infoDiv = document.createElement("div");
    infoDiv.style.padding = "15px";
    infoDiv.style.background = "#f4f4f4";
    infoDiv.style.border = "1px solid #ccc";
    infoDiv.style.borderRadius = "8px";
    infoDiv.style.margin = "20px auto";
    infoDiv.style.textAlign = "center";
    infoDiv.innerHTML = `
        <h3>Dispositivo conectado</h3>
        <p><strong>MAC del cliente:</strong> ${mac}</p>
        <p><strong>IP del cliente:</strong> ${ip}</p>
        <p><strong>MAC del AP:</strong> ${ap}</p>
    `;

    document.body.prepend(infoDiv);

    console.log("✅ Datos del cliente:", { mac, ip, ap });
            const nombre = document.getElementById("nombre").value.trim();
            const apellido = document.getElementById("apellido").value.trim();
            const cedula = document.getElementById("cedula").value.trim();
            const telefono = document.getElementById("telefono").value.trim();
            const correo = document.getElementById("correo").value.trim();
            const errorMsg = document.getElementById("errorMsg");

            if (!nombre || !apellido || !cedula || !telefono || !correo) {
                e.preventDefault();
                errorMsg.textContent = "⚠️ Todos los campos son obligatorios.";
                errorMsg.style.display = "block";
                return;
            }

            if (!validarCedula(cedula)) {
                e.preventDefault();
                errorMsg.textContent = "⚠️ Cédula ecuatoriana no válida.";
                errorMsg.style.display = "block";
                return;
            }

            if (!validarTelefono(telefono)) {
                e.preventDefault();
                errorMsg.textContent = "⚠️ El teléfono debe empezar con 09 y tener 10 dígitos.";
                errorMsg.style.display = "block";
                return;
            }

            errorMsg.style.display = "none";
            console.log("✅ Validación completada correctamente. Enviando formulario...");
        });
    </script>

</body>
</html>
